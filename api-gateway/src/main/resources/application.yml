server:
  servlet:
    context-path: /${spring.application.name}
  port: ${API_GATEWAY_PORT:9000}
  shutdown: graceful
  tomcat:
    connection-timeout: 5s
    threads:
      max: 100
      min-spare: 10


spring:
  application:
    name: gateway
  cloud:
    gateway:
      default-filters:
        - TokenRelay
      routes:
        - id: account-service-public
          uri: http://127.0.0.1:7020
          predicates:
            - Path=/public/account/**      
          filters:
           - SaveSession
           - RewritePath= /public/account(?<segment>/?.*), /account-service$\{segment}         
           - RemoveRequestHeader=Cookie
        - id: catalog-service-public
          uri: http://127.0.0.1:7010
          predicates:
            - Path=/public/catalog/**      
          filters:
           - SaveSession
           - RewritePath= /public/catalog(?<segment>/?.*), /catalog-service$\{segment}         
           - RemoveRequestHeader=Cookie
        - id: delivery-service-public
          uri: http://127.0.0.1:7055
          predicates:
            - Path=/public/delivery/**      
          filters:
           - SaveSession
           - RewritePath= /public/delivery(?<segment>/?.*), /delivery-service$\{segment}         
           - RemoveRequestHeader=Cookie
        - id: order-history-service-public
          uri: http://127.0.0.1:7040
          predicates:
            - Path=/public/history-order/**      
          filters:
           - SaveSession
           - RewritePath= /public/history-order(?<segment>/?.*), /order-history-service$\{segment}         
           - RemoveRequestHeader=Cookie     
        - id: order-service-public
          uri: http://127.0.0.1:7030
          predicates:
            - Path=/public/order/**      
          filters:
           - SaveSession
           - RewritePath= /public/order(?<segment>/?.*), /order-service$\{segment}         
           - RemoveRequestHeader=Cookie
        - id: payment-service-public
          uri: http://127.0.0.1:7050
          predicates:
            - Path=/public/payment/**      
          filters:
           - SaveSession
           - RewritePath= /public/payment(?<segment>/?.*), /payment-service$\{segment}         
           - RemoveRequestHeader=Cookie
        - id: warehouse-service-public
          uri: http://127.0.0.1:7000
          predicates:
            - Path=/public/warehouse/**      
          filters:
           - SaveSession
           - RewritePath= /public/warehouse(?<segment>/?.*), /warehouse-service$\{segment}         
           - RemoveRequestHeader=Cookie          
        - id: account-service-private
          uri: http://127.0.0.1:7020
          predicates:
            - Path=/private/account/**      
          filters:
           - RewritePath= /private/account(?<segment>/?.*), /account-service$\{segment}         
           - RemoveRequestHeader=Cookie
        - id: catalog-service-private
          uri: http://127.0.0.1:7010
          predicates:
            - Path=/private/catalog/**      
          filters:
           - RewritePath= /private/catalog(?<segment>/?.*), /catalog-service$\{segment}         
           - RemoveRequestHeader=Cookie
        - id: delivery-service-private
          uri: http://127.0.0.1:7055
          predicates:
            - Path=/private/delivery/**      
          filters:
           - RewritePath= /private/delivery(?<segment>/?.*), /delivery-service$\{segment}         
           - RemoveRequestHeader=Cookie
        - id: order-history-service-private
          uri: http://127.0.0.1:7040
          predicates:
            - Path=/private/history-order/**      
          filters:
           - RewritePath= /private/history-order(?<segment>/?.*), /order-history-service$\{segment}         
           - RemoveRequestHeader=Cookie        
    
        - id: order-service-private
          uri: http://127.0.0.1:7030
          predicates:
            - Path=/private/order/**      
          filters:
           - RewritePath= /private/order(?<segment>/?.*), /order-service$\{segment}         
           - RemoveRequestHeader=Cookie
    
        - id: payment-service-private
          uri: http://127.0.0.1:7050
          predicates:
            - Path=/private/payment/**      
          filters:
           - RewritePath= /private/payment(?<segment>/?.*), /payments-service$\{segment}         
           - RemoveRequestHeader=Cookie
    
        - id: warehouse-service-private
          uri: http://127.0.0.1:7000
          predicates:
            - Path=/private/warehouse/**           
          filters:
           - RewritePath= /private/warehouse(?<segment>/?.*), /warehouse-service$\{segment}         
           - RemoveRequestHeader=Cookie        
  redis:
    connect-timeout: 30s
    host: localhost
    port: 6379
    timeout: 500ms
  session:
    store-type: redis
    timeout: 10m
    redis:
      namespace: library:edge

  security:
    oauth2:
      client:
        provider:
          oidc:
           # issuer-uri: http://localhost:8090/auth/realms/aqstore-spring-realm
           token-uri: http://localhost:8090/auth/realms/aqstore-spring-realm/protocol/openid-connect/token
           authorization-uri: http://localhost:8090/auth/realms/aqstore-spring-realm/protocol/openid-connect/auth
           user-info-uri: http://localhost:8090/auth/realms/aqstore-spring-realm/protocol/openid-connect/userinfo
           user-name-attribute: preferred_username
        registration:
          oidc:
            provider: oidc
            client-id: aqstore-api-gateway
            client-secret: f65bc943-40ac-4723-87a3-5a388cae6772
            authorization-grant-type: authorization_code
            redirect-uri: "{baseUrl}/login/oauth2/code/keycloak"


logging.level:
  '[org.springframework.cloud.gateway]': DEBUG
  '[org.springframework.security]': DEBUG
  '[org.springframework.web.reactive.function.client]': TRACE

management:
  endpoints:
    web:
      exposure:
        include: "*"
